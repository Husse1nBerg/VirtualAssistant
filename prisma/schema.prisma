generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model CallLog {
  id               String   @id @default(uuid())
  twilioCallSid    String   @unique
  fromNumber       String
  toNumber         String
  direction        String   @default("inbound")
  status           String   @default("in-progress") // in-progress | completed | failed | voicemail
  startedAt        DateTime @default(now())
  endedAt          DateTime?
  durationSeconds  Int?

  // Structured outcomes
  callerName       String?
  company          String?
  reasonForCall    String?
  urgency          String?  // low | medium | high
  callbackWindow   String?
  promisedActions  String?  // JSON string array
  confidenceScore  Float?
  sentiment        String?  // positive | neutral | frustrated | angry | distressed
  summary          String?

  // Metrics
  sttLatencyMs     Int?
  llmLatencyMs     Int?
  ttsLatencyMs     Int?
  usedFallback     Boolean  @default(false)

  // Call recording (full conversation)
  recordingSid     String?
  recordingUrl     String?

  // Relations
  transcripts      Transcript[]
  notifications    NotificationLog[]

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Transcript {
  id         String   @id @default(uuid())
  callLogId  String
  callLog    CallLog  @relation(fields: [callLogId], references: [id], onDelete: Cascade)
  role       String   // caller | assistant | system
  content    String
  timestamp  DateTime @default(now())

  createdAt  DateTime @default(now())
}

model NotificationLog {
  id         String   @id @default(uuid())
  callLogId  String
  callLog    CallLog  @relation(fields: [callLogId], references: [id], onDelete: Cascade)
  channel    String   // sms | whatsapp
  recipient  String
  status     String   // sent | failed | pending
  messageId  String?  // Twilio message SID
  error      String?
  sentAt     DateTime?

  createdAt  DateTime @default(now())
}

model Contact {
  id          String   @id @default(uuid())
  phoneNumber String   @unique
  name        String
  isVip       Boolean  @default(false)
  notes       String?  // e.g. "dad", "best client"
  language    String   @default("en") // BCP-47 language code: "en", "ar", "fr", etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
